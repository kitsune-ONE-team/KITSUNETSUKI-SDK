- job-template:
    name: clean-{path}-lynx64
    display-name: clean-{path}-lynx64
    project-type: freestyle
    description: Clean up "{path}" for all jobs.
    node: linux
    build-discarder:
        daysToKeep: -1
        numToKeep: 2
        artifactDaysToKeep: -1
        artifactNumToKeep: -1
    builders:
        - shell: |
            rm -Rf /app/{path}/*

- job-template:
    name: clean-{path}-winx64
    display-name: clean-{path}-winx64
    project-type: freestyle
    description: Clean up "{path}" for all jobs.
    node: windows
    build-discarder:
        daysToKeep: -1
        numToKeep: 2
        artifactDaysToKeep: -1
        artifactNumToKeep: -1
    builders:
        - batch: |
            rd /S /Q C:\{path}
            rd /S /Q C:\jenkins\workspace\panda3d-winx64\build

- project:
    name: clean-build
    jobs:
        - 'clean-{path}-lynx64':
            path: build
        - 'clean-{path}-winx64':
            path: build

- project:
    name: clean-opt
    jobs:
        - 'clean-{path}-lynx64':
            path: opt
        - 'clean-{path}-winx64':
            path: opt

- job:
    name: pipeline-lynx64
    display-name: pipeline-lynx64
    project-type: pipeline
    description: KITSUNETSUKI SDK pipeline
    node: windows
    build-discarder:
        daysToKeep: -1
        numToKeep: 2
        artifactDaysToKeep: -1
        artifactNumToKeep: -1
    dsl: |
      pipeline {{
          agent any
          stages {{
              stage('clean-opt') {{
                  steps {{ build job: 'clean-opt-lynx64' }}
              }}
              stage('bullet') {{
                  steps {{ build job: 'bullet-lynx64' }}
              }}
              stage('ogg') {{
                  steps {{ build job: 'ogg-lynx64' }}
              }}
              stage('vorbis') {{
                  steps {{ build job: 'vorbis-lynx64' }}
              }}
              stage('sdl') {{
                  steps {{ build job: 'sdl-lynx64' }}
              }}
              stage('python') {{
                  steps {{ build job: 'python-lynx64' }}
              }}
              stage('panda3d') {{
                  steps {{ build job: 'panda3d-lynx64' }}
              }}
              stage('panda3d-kphys') {{
                  steps {{ build job: 'panda3d-kphys-lynx64' }}
              }}
              stage('panda3d-krender') {{
                  steps {{ build job: 'panda3d-krender-lynx64' }}
              }}
              stage('sdk') {{
                  steps {{ build job: 'sdk-lynx64' }}
              }}
          }}
      }}

- job:
    name: pipeline-winx64
    display-name: pipeline-winx64
    project-type: pipeline
    description: KITSUNETSUKI SDK pipeline
    node: windows
    build-discarder:
        daysToKeep: -1
        numToKeep: 2
        artifactDaysToKeep: -1
        artifactNumToKeep: -1
    dsl: |
      pipeline {{
          agent any
          stages {{
              stage('clean-opt') {{
                  steps {{ build job: 'clean-opt-winx64' }}
              }}
              stage('bullet') {{
                  steps {{ build job: 'bullet-winx64' }}
              }}
              stage('sdl') {{
                  steps {{ build job: 'sdl-winx64' }}
              }}
              stage('python') {{
                  steps {{ build job: 'python-winx64' }}
              }}
              stage('panda3d') {{
                  steps {{ build job: 'panda3d-winx64' }}
              }}
              stage('panda3d-kphys') {{
                  steps {{ build job: 'panda3d-kphys-winx64' }}
              }}
              stage('panda3d-krender') {{
                  steps {{ build job: 'panda3d-krender-winx64' }}
              }}
              stage('sdk') {{
                  steps {{ build job: 'sdk-winx64' }}
              }}
          }}
      }}
