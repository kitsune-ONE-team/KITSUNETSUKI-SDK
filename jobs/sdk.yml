- job-template:
    name: sdk-lynx64
    display-name: sdk-lynx64
    project-type: freestyle
    description: KITSUNETSUKI SDK
    node: linux
    build-discarder:
      daysToKeep: -1
      numToKeep: 2
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
    builders:
      - shell: |
          mkdir -p {build}
          cd {build}

          if [ ! -f discord.zip ]; then
              wget -O discord.zip https://dl-game-sdk.discordapp.net/3.2.1/discord_game_sdk.zip
              7z x -odiscord discord.zip
          fi

          mkdir -p {install}/include
          mkdir -p {install}/lib
          cp -Rfv /app/opt/python/bin                            {install}/
          cp -Rfv /app/opt/python/include/python{python_version} {install}/include/
          cp -Rfv /app/opt/python/lib                            {install}/
          cp -Rfv /app/opt/panda3d/bin                           {install}/
          cp -Rfv /app/opt/panda3d/etc                           {install}/
          cp -Rfv /app/opt/panda3d/include                       {install}/
          cp -Rfv /app/opt/panda3d/lib                           {install}/
          cp -Rfv /app/opt/panda3d-kphys/lib                     {install}/
          cp -Rfv /app/opt/panda3d-krender/lib                   {install}/
          cp -Rfv /app/opt/sdl/include                           {install}/
          cp -Rfv /app/opt/sdl/lib                               {install}/
          cp -Rfv discord/c/*                                    {install}/include/
          cp -fv discord/lib/x86_64/discord_game_sdk.so          {install}/lib/libdiscord_game_sdk.so

          PYTHONHOME={install} {install}/bin/python3.13t -m \
              pip install git+https://github.com/abravalheri/setuptools.git@issue-4420
          PYTHONHOME={install} {install}/bin/python3.13t -m \
              pip install \
              -C "--build-option=--py-limited-api ''" \
              -r /app/jobs/sdk/requirements.txt

- job-template:
    name: sdk-winx64
    display-name: sdk-winx64
    project-type: freestyle
    description: KITSUNETSUKI SDK
    node: windows
    build-discarder:
      daysToKeep: -1
      numToKeep: 2
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
    builders:
      - batch: |
          mkdir -p {build}
          cd {build}

          set GIT=Z:\Git\bin\git
          set ZIP=Z:\7-Zip\7z
          set PATH=%PATH%;Z:\Git\bin

          if not exist discord.zip (
              curl -o discord.zip https://dl-game-sdk.discordapp.net/3.2.1/discord_game_sdk.zip
              %ZIP% x -odiscord discord.zip
          )

          mkdir {install}
          mkdir {install}\include
          mkdir {install}\lib
          xcopy /I /E /Y C:\opt\python\DLLs           {install}\DLLs
          xcopy /I /E /Y C:\opt\python\bin            {install}\bin
          xcopy /I /E /Y C:\opt\python\lib            {install}\lib
          xcopy /I /E /Y C:\opt\python\libs           {install}\libs
          xcopy /I /E /Y C:\opt\python\include        {install}\include
          xcopy /I /E /Y C:\opt\panda3d\bin           {install}\bin
          xcopy /I /E /Y C:\opt\panda3d\etc           {install}\etc
          xcopy /I /E /Y C:\opt\panda3d\include       {install}\include
          xcopy /I /E /Y C:\opt\panda3d\lib           {install}\lib
          xcopy /I /E /Y C:\opt\panda3d-kphys\lib     {install}\lib
          xcopy /I /E /Y C:\opt\panda3d-krender\lib   {install}\lib
          xcopy /I /E /Y C:\opt\sdl\bin               {install}\bin
          xcopy /I /E /Y C:\opt\sdl\include           {install}\include
          xcopy /I /E /Y C:\opt\sdl\lib               {install}\lib
          xcopy /I /E /Y discord\c                {install}\include
          copy /V /Y     discord\lib\x86_64\*.dll {install}\bin

          set PYTHONHOME={install}
          {install}\bin\python3.13t -m ^
              pip install git+https://github.com/abravalheri/setuptools.git@issue-4420
          {install}\bin\python3.13t -m ^
              pip install ^
              -C "--build-option=--py-limited-api ''" ^
              -r C:\jenkins\workspace\panda3d-winx64\build\sdk\jobs\sdk\requirements.txt

- project:
    name: sdk-lynx64
    jobs:
      - 'sdk-lynx64':
          build: /app/build/sdk
          install: /app/opt/sdk
          python_version: '3.13t'

- project:
    name: sdk-winx64
    jobs:
      - 'sdk-winx64':
          build: 'C:\build\sdk'
          install: 'C:\opt\sdk'
          python_version: '3.13t'
